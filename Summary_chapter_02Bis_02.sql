SET GLOBAL SQL_MODE = CONCAT(@@SQL_MODE, ',ONLY_FULL_GROUP_BY');

SELECT li.ID_S
FROM spj li
GROUP BY li.ID_S
HAVING COUNT(li.DATE_DERNIERE_LIVRAISON) >= 4
   AND COUNT(DISTINCT li.ID_P) >= 3;
